#include <linux/if_ether.h>
#include <linux/if_packet.h>
#include <net/if.h>
#include <netinet/in.h>
#include <string.h>
#include <sys/ioctl.h>
#include <sys/socket.h>
#include <unistd.h>
#include "stdio.h"
#include <math.h>
#include <stdio.h>
#include <stdlib.h>
#include <pthread.h>
#include <time.h>

#include "hrav_protocol.h"


#define DEFAULT_IFACE	"nf1"
int sockfd;
int error;

int main(int argc, char *argv[])
{
	static char* iface_name = DEFAULT_IFACE;
    sockfd = open_device(iface_name);

	printf("Size of struct header %d packet %d buffer %d \n",sizeof(HEADER),sizeof(PACKET),sizeof(BUFFER));

    //char sendbuff[32768] = "\xCA\xAE\xFE\x01\xFF\xFF\xFF\x4\x1B\xED\xA5\x39\x65\xB3\x24\x39\x4A\xA3\xF1\x5A\x6E\xBF\xC1\xB4\xF4\xE5\x35\xDA\xCE\x4D\x38\xD2\xA6\x2C\x5E\xA3\xB4\x53\x15\x3F\x5B\x4A\x7F\x83\x11\x59\x49\xFF\x8E\xFB\xEC\xA9\x5A\x24\x2C\x58\x75\x75\x7A\xC6\x15\x66\x52\xD3\xC2\xB3\xA9\x3D\x11\xA8\x6B\x2A\x53\x2F\x61\x42\x9A\xC5\xEC\x9A\x72\x1C\xBE\xCB\xE7\x58\xEA\xA7\x43\x17\x66\x6E\x96\x1C\xF4\xD8\x21\xCF\x46\x8E\xBB\x2F\xE8\x39\xC5\x1F\x1F\x95\x31\x99\xE4\x6E\x3C\xB2\x8A\x91\x81\xF2\x8C\x8B\xEE\xE7\x86\xBA\xE1\xF9\x5E\xE4\xF4\x5F\xF1\xC9\x7C\x43\xB6\x32\xF7\xE9\x5D\xEC\x8C\x67\xDE\xBF\x16\xAF\xAB\xC2\x45\xD1\xD4\x6E\x6F\xEF\xFB\x7E\x7E\x3B\xAE\xB9\x64\xE3\xD5\x8C\xB5\xFB\x54\xB2\xF6\x47\x36\x31\x62\x3D\x13\x83\x1C\x62\xA8\x53\x73\x18\xBE\x74\x79\x1B\x78\xA5\x26\x1F\x21\xE9\x5D\xFF\x83\xD5\xDA\x77\x4F\x5E\x4A\xF3\xC5\x25\x3B\x49\x5D\x15\x5E\x66\x6C\xAA\x86\x73\x17\x7D\x77\x8A\x49\x72\x34\x9F\xF5\x97\xDC\x2F\x85\xF1\xC5\x1B\x66\xFB\x1A\x25\x93\x4C\xF7\x54\x78\x62\x5F\xFE\x8F\xB9\x2F\xC2\x37\x66\x5E\xC5\x6D\x38\xDF\x43\x1F\x37\x6D\x28\x56\xB3\xDB\x26\xF6\xDE\xC1\x3B\xE3\x2F\x8F\xDD\x4A\x8E\x55\x12\xB9\x8A\x3A\x41\x59\x3B\x88\x85\xDF\x44\x14\x41\xF5\x7C\x2B\xFE\x9E\x98\x6C\xBA\xAE\xE9\xDA\xC6\x78\x82\xCD\x27\xEE\x88\xF3\xF4\x27\x24\x1A\xF8\x8E\x85\x6E\xA6\xC1\x99\x9A\x51\xE5\x62\xBA\xED\x39\x55\x99\x8A\xB5\x96\x71\x8A\x9D\x4A\x8F\xBE\xAA\xB3\x58\x5C\x2A\xE3\x68\x71\x81\x1E\x97\x44\x63\x2E\xD7\x1F\xE8\xF6\x9B\x1A\x38\x46\x79\x31\x61\x46\x89\xFF\xDC\x7D\xE5\xC2\x9E\xB6\x4B\xC5\x45\xC4\x8C\x41\xAF\x8F\x65\x7E\x96\xA2\x53\xBF\x91\x4D\x82\xC6\xCC\xE7\x4E\xBD\x25\x15\x4E\x82\x74\xD6\xB6\x73\x47\x5D\x77\xED\x52\x8A\x63\x61\xEB\x19\x1A\x34\x43\xEE\xE1\x25\x6F\x58\xDB\x3B\xCA\x5B\x18\x5F\xE4\x66\xE7\xDF\x1B\x77\x2D\x8F\x95\x1F\x65\xF1\xCC\x67\xF4\xA8\x8F\xDA\xB8\xE5\xF5\x5A\x25\x5E\x2D\x8C\x82\xFC\x41\x3B\x26\xBC\x78\x3D\x4D\x52\x1E\x44\x73\xA6\xF1\xDF\xD4\x35\xC4\x66\x1F\xA5\x36\x51\xC8\x68\x57\xE3\x27\x68\x93\xCB\x6A\x24\xEB\xD4\xB2\x13\x4D\x67\x7A\x49\x9F\x36\xC5\x42\xDF\xDF\x5B\x3F\x33\x75\x81\x36\x14\x98\xC3\xE1\xA2\x42\x12\x53\xE2\x58\x1C\x24\xFD\xA3\x53\xFE\x16\xCB\x88\x12\xD2\x38\x8A\xFD\xA2\x95\xB1\x54\x9A\xF1\xAF\x42\xF2\x8A\x87\xC2\xDE\x7C\xE9\xC2\xC2\x1D\x84\xB9\xDA\x74\x52\xA9\xFC\x2A\xD4\x22\x9E\xCF\xF9\x3B\x96\x3B\x13\xD2\x4B\xA8\x18\xB3\x23\xF4\x52\x75\x86\x6F\x41\xB3\xDE\x4C\xC1\x9D\x67\x34\x88\xAE\xEF\xBF\x27\x88\xA8\xB7\x6B\xF2\x61\xCB\x3E\x15\x2C\x91\xDC\x6B\xF2\x8C\x12\x39\xF8\xAC\x2A\x19\x5E\x49\x3C\xC9\xD5\x7A\x77\x37\xCB\xD9\x14\xCE\xAA\x74\x61\xED\xB6\x22\x36\xB1\x4C\xB1\x78\xDC\xFD\x7F\xCA\x14\x6C\x33\x6F\xDD\x46\x8A\x4F\xFA\xC8\x61\xB7\xBF\xDF\xF2\x7E\x88\x4C\x78\x16\xCE\x1D\x92\xE4\x14\x88\x97\xAE\xB8\xB9\x58\x88\x29\x7A\x31\x46\x99\x2B\xB4\xD5\xD6\xDD\x1A\x17\xA8\xE2\x12\x53\xCA\x5D\x53\xD3\x1C\xEF\xA7\xF3\x67\x75\x9D\x8E\x41\xD4\x7A\x85\xF9\xA8\x8E\xEF\x1B\x15\x6B\x17\xF1\x62\x99\x8F\xA6\x28\x7F\x93\x89\x76\xEA\x79\xE6\xDE\x3D\xC7\x7B\xB9\x94\xD7\x4A\x64\x6F\x65\x19\xFB\xB6\x51\x9F\x37\xD3\x2B\x68\xCB\x2C\x86\x16\x6F\x1E\x89\xF6\xF7\x4E\x2B\x45\x32\xCC\x12\x5B\xE6\xC2\xD3\x91\x7F\xC2\xCD\x96\xAC\xDC\xD2\x7C\x28\x4F\x97\xD1\xD9\x41\x67\x5A\x14\x96\x46\xE4\x3D\x96\xF8\x1F\xB6\xB8\x3B\xC2\x4F\x49\xB4\x8F\x64\xE5\x63\xC3\xB7\x6C\xCD\xED\xEB\xBF\x37\x21\x4D\xB9\xC8\x6A\xA5\xA3\x32\xE7\xB9\xC5\x85\x2A\x93\x1B\xA6\xD4\x6D\x95\x97\x7C\x11\xA3\x9D\x2C\x49\x25\xA3\xB4\x1A\xB8\xF2\x2E\x47\x81\x68\x15\x43\x9F\x88\x6D\x7E\x27\x3E\xBC\x19\x54\xFE\xFF\x4B\x18\x1D\x3B\x29\x4F\x2E\xBC\xF7\xA4\x79\x22\x5A\x46\x29\x33\x5B\xAC\x66\xAE\x8E\xDA\x63\xFA\x85\x1A\xFC\xB1\xB9\xBC\x67\x8B\x5E\xA7\xA4\x2F\x3A\x8E\xCF\x91\x86\xC4\x89\x85\xD3\x9D\x7A\xB4\xE4\x8F\x6D\xDA\x65\x95\xD7\xC7\x9B\x3F\xFD\xA3\xC8\x57\xFF\x18\xEA\x78\x5B\x6A\xCC\xA7\xF7\x7D\x4F\xD6\x58\x87\xFB\xC7\xDE\x5F\xF7\x35\x83\x21\xE7\x78\x22\xFC\x35\xBB\x87\xDA\x25\x81\x67\xE7\x8C\x76\x8D\xF4\x43\x89\x62\xF2\xD8\x25\x3A\xAF\xD2\xAF\xFD\xD7\x13\xCD\xAC\x45\x6D\xB1\xBE\xCA\x57\xDB\x77\x2F\xA3\xCD\x28\x25\x4D\x3D\x4B\x9F\x5E\xEC\x67\xC5\x37\x66\x28\xCA\xE1\x9C\xB9\x15\x37\xEB\xD8\x2A\x9E\x6A\xD6\xDA\xDD\xF6\x21\xEA\xD8\xDE\xC7\x5D\xD1\x24\xB3\xE7\xAD\x12\xC5\xFD\xA2\x95\xBD\x54\x16\x4A\xCE\xBB\x85\xF5\x6C\x19\x8F\xAA\xEE\xF2\x3D\xDF\x18\xE2\xB2\x16\x62\x57\x14\xAD\xDE\xF2\x9D\xB6\x8D\xDC\x47\xD8\xA1\xAF\xFF\x8F\x61\x6B\xB4\x91\xBF\x3D\xBB\x41\x4E\x47\x17\x45\xF8\xB7\xCD\x34\xA8\x1C\xE2\x59\xBF\xA8\x78\x8A\x13\x52\x78\x93\xF1\x9B\x86\x31\xA8\x85\xAE\x94\x6E\xD6\x81\xF1\xB7\xA5\xC3\x38\xDE\xDD\xBB\xB6\x59\xE9\x4C\x4C\x45\x9A\xED\x4B\xF1\xD8\xE4\x53\xF4\x21\x45\x72\xDB\x83\x59\x8A\xD1\x8A\x41\x57\x25\xFF\x5C\x42\xCB\x33\x46\x24\x8F\x5B\xA5\x17\x8B\x47\x6C\x1D\x2D\x92\x1F\x4E\xFD\xEB\x99\xAB\xEA\x1D\xB1\x8C\x8B\x38\xB5\x13\xDE\x2A\x5D\x3B\x16\xFB\x46\x1B\xEC\xE6\x82\x51\x29\xCB\x2E\x8F\x1D\x45\xA4\xF7\x81\xCF\xE3\xD8\xFA\x3B\xFD\x4B\x95\x1C\x26\xA4\xE2\x95\x92\xCB\x1A\xE8\x82\xAA\x92\x1E\xB1\x11\x3E\xEE\xD1\xBF\x74\xDA\x3C\x7B\x7C\x32\xA9\x52\xB5\x4C\xD1\xBE\xAC\x6E\xF2\x52\x62\x37\x82\xAE\xE1\xFE\x68\x2D\x8A\x4E\x86\x48\xF9\xED\xB7\xD4\x21\x73\x77\x51\xB2\xAA\xFF\x5C\x38\xC4\xFA\x78\xC3\x94\xC6\x4B\x28\x71\x1E\xCC\x13\x37\xB4\xB3\xD8\xF1\x8A\xC3\x6D\x9D\x68\x1A\x2B\x5E\x57\x5E\x16\x22\xEA\x5E\xDE\x98\xCE\x44\xD5\x9E\x76\x58\x2F\x8A\x6A\xDF\x69\x82\x17\x3F\x5E\x33\xCB\x6B\xD4\x49\xAE\x73\x8F\x72\xD5\x5D\x98\x7E\xF4\x2B\x8F\xB5\x6B\x44\x93\x5D\x8C\xCC\x6F\x7B\xCE\xAE\xF3\x9E\x81\x1A\x4F\x61\xB2\xB2\xBD\xDC\x46\x48\x96\x83\x14\x26\x5F\xCC\x3D\xD6\xE7\x46\x88\x8E\x97\x9F\xB5\x66\x63\xE9\x7B\x1D\xE8\xD3\xC3\xCE\xD6\x3E\x3C\xAB\x98\x95\x15\x52\x8F\xCC\x5E\x9E\x8E\xE8\x9E\x44\x92\xC6\x47\x7E\xE5\x81\xE1\x3B\x35\xDA\x26\xCE\x65\x1D\x39\x9C\x1B\x8F\x5D\xEB\xC1\xDA\xAC\x3D\x43\xFE\xFD\x55\x75\x3E\xC7\x5B\x17\x94\x2C\x9D\x41\x95\x73\xA9\x9E\x42\x8C\x2E\xAC\x23\xA3\xB9\xD8\x38\xC7\x12\x51\x2D\x6B\xEF\xCE\x1A\x11\xB8\x9B\x73\xA4\xE8\x9C\x61\xD6\x92\x56\xDA\xA3\x95\xD2\x85\xCC\x33\x34\xCA\x35\x51\x6E\x21\xA4\x19\xA5\x34\x4F\x15\xE2\x59\x4B\x9C\x8D\xA8\x72\xD2";
//    char sendbuff[32768] = {0xab,0xcd,0xef,0x33,0x0};
//    PrintInHex("sendbuf = ",sendbuff,strlen(sendbuff));
	// Handle buffer segmentation.
	char sendbuff[2048] = "\xCA\xAE\xFE\x01\xFF\xFF\xFF\x4\x1B\xED\xA5\x39\x65\xB3\x24\x39\x4A\xA3\xF1\x5A\x6E\xBF\xC1\xB4\xF4\xE5\x35\xDA\xCE\x4D\x38\xD2\xA6\x2C\x5E\xA3\xB4\x53\x15\x3F\x5B\x4A\x7F\x83\x11\x59\x49\xFF\x8E\xFB\xEC\xA9\x5A\x24\x2C\x58\x75\x75\x7A\xC6\x15\x66\x52\xD3\xC2\xB3\xA9\x3D\x11\xA8\x6B\x2A\x53\x2F\x61\x42\x9A\xC5\xEC\x9A\x72\x1C\xBE\xCB\xE7\x58\xEA\xA7\x43\x17\x66\x6E\x96\x1C\xF4\xD8\x21\xCF\x46\x8E\xBB\x2F\xE8\x39\xC5\x1F\x1F\x95\x31\x99\xE4\x6E\x3C\xB2\x8A\x91\x81\xF2\x8C\x8B\xEE\xE7\x86\xBA\xE1\xF9\x5E\xE4\xF4\x5F\xF1\xC9\x7C\x43\xB6\x32\xF7\xE9\x5D\xEC\x8C\x67\xDE\xBF\x16\xAF\xAB\xC2\x45\xD1\xD4\x6E\x6F\xEF\xFB\x7E\x7E\x3B\xAE";
	int bufferID = 0;
	int send_buffer_length= 100;
	printf("send_buffer_length = %d\n",send_buffer_length);
	

	error =  hrav_send_buff(sockfd, bufferID, sendbuff, send_buffer_length);
	if(error){
		printf("send: error sending");
	}

	shutdown(sockfd, SHUT_RDWR);
	close(sockfd);
	exit(0);
}
